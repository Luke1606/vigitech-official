generator client {
	provider = "prisma-client-js"
    output = "../node_modules/.prisma/client"
}

datasource db {
	provider  = "postgresql"
	url       = env("DATABASE_URL")
}

model User {
	id                             String               @id @default(uuid())
	email                          String               @unique
	name                           String
    
    createdAt                      DateTime             @default(now())
    updatedAt                      DateTime             @updatedAt
    
    lists                          UserItemList[]
    preferences                    UserPreferences?
}


enum NotificationChannel {
    IN_APP
    EMAIL
    PUSH
    SMS
}

model UserItemList {
    id                             String               @id @default(uuid())    
    name                           String
    preferredNotificationChannel   NotificationChannel  @default(IN_APP)

    createdAt                      DateTime             @default(now())
    updatedAt                      DateTime             @updatedAt
    
    ownerId                        String
    owner                          User                 @relation(fields: [ownerId], references: [id])
    items                          SurveyItem[]         @relation("ListItems")
}


enum Theme {
    DARK
    LIGHT
    SYSTEM
}

enum Language {
    EN
    ES
}

enum Frequency {
    EVERY_10_MINUTES
    EVERY_30_MINUTES
    HOURLY
    EVERY_6_HOURS
    DAILY
    EVERY_TWO_DAYS
    EVERY_FOUR_DAYS
    WEEKLY
}

model UserPreferences {
    id                             String               @id @default(uuid())
    theme                          Theme                @default(SYSTEM)
    language                       Language             @default(ES)
    defaultNotificationChannel     NotificationChannel  @default(IN_APP)
    analysisFrequency              Frequency            @default(EVERY_6_HOURS)
    recommendationsUpdateFrequency Frequency            @default(DAILY)

    createdAt                      DateTime             @default(now())
    updatedAt                      DateTime             @updatedAt

	userId                         String               @unique
    user                           User?                @relation(fields: [userId], references: [id])
}


enum RadarQuadrant {
    BUSSINESS_INTEL
    SCIENTIFIC_STAGE
    SUPPORT_PLATTFORMS_AND_TECHNOLOGIES
    LANGUAGES_AND_FRAMEWORKS
}

enum RadarRing {
    ADOPT
    TEST
    SUSTAIN
    HOLD
}

model SurveyItem {
    id                             String               @id @default(uuid())
    title                          String
	summary                        String
	source                         String
    subscribed                     Boolean              @default(false)
    active                         Boolean              @default(false)

    radarQuadrant                  RadarQuadrant
    radarRing                      RadarRing

    createdAt                      DateTime             @default(now())
    updatedAt                      DateTime             @updatedAt

    analysisHistory                SubscribedItemAnalysis[]  
    lists                          UserItemList[]       @relation("ListItems")
    reports                        Report[]             @relation("ReportItems")
}



model GeneralSearchResult {
    id                            String               @id @default(uuid())
    crossRefResult                Json
    lensResult                    Json
    openAlexResult                Json
    unpaywallResult               Json

    analysis                      SubscribedItemAnalysis?
}


enum Trending {
    UP
    DOWN
    STABLE
    UNSTABLE
}

enum AccesibilityLevel {
    FREE
    PAID
}

model Metrics {
    id                            String               @id @default(uuid())
    citations                     Int
    downloads                     Int
    relevance                     Float
    accesibilityLevel             AccesibilityLevel
    trending                      Trending

    analysis                      SubscribedItemAnalysis?
}


model SubscribedItemAnalysis {
	id                             String               @id @default(uuid())
    
    createdAt                      DateTime             @default(now())
    updatedAt                      DateTime             @updatedAt

	itemId                         String

    dataId                         String               @unique
	searchedData                   GeneralSearchResult  @relation(fields: [dataId], references: [id])

    metricsId                      String               @unique
    analyzedMetrics                Metrics              @relation(fields: [metricsId], references: [id])

    item                           SurveyItem           @relation(fields: [itemId], references: [id])
}


model Report {
    id                             String               @id @default(uuid())
    startDate                      DateTime
    endDate                        DateTime             @default(now())
    
    createdAt                      DateTime             @default(now())
    updatedAt                      DateTime             @updatedAt

    items                          SurveyItem[]         @relation("ReportItems")
}


